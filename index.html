<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formulir Asesmen JITUPASNA</title>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    
    <style>
        /* --- (BAGIAN CSS UNTUK TAMPILAN) --- */
        
        :root {
            --primary-color: #d9534f;
            --secondary-color: #007bff; /* Biru untuk tombol lokasi */
            --light-bg: #fff8f8;
            --card-bg: #ffffff;
            --text-color: #333;
            --border-color: #ddd;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--light-bg);
            color: var(--text-color);
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }

        h1 {
            text-align: center;
            color: var(--primary-color);
            margin-bottom: 30px;
        }

        form {
            max-width: 800px;
            margin: 0 auto;
        }

        .card {
            background: var(--card-bg);
            border-radius: 8px;
            box-shadow: var(--shadow);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid var(--border-color);
        }

        .card-header {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
            margin-bottom: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

	.kerusakan-fisik-group {
    	    display: none; /* Sembunyi by default */
	}

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 0.95rem;
        }
        
        label.note {
            font-weight: normal;
            font-size: 0.85rem;
            color: #777;
            margin-top: -5px;
        }

        input[type="text"],
        input[type="number"],
        input[type="tel"],
        input[type="file"],
        select,
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-sizing: border-box; 
            font-size: 1rem;
            transition: border-color 0.2s, box-shadow 0.2s;
            background-color: #fff; /* Pastikan background select putih */
        }
        
        /* Style khusus untuk select yang nonaktif */
        select:disabled {
            background-color: #f4f4f4;
            cursor: not-allowed;
        }

        input[type="file"] {
            padding: 9px;
            background: #fdfdfd;
        }

        input[type="text"]:focus,
        input[type="number"]:focus,
        input[type="tel"]:focus,
        input[type="file"]:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(217, 83, 79, 0.15);
        }
        
        textarea {
            min-height: 120px;
            resize: vertical;
        }
        
        /* CSS Untuk List Builder (Personil/Unsur) */
        .list-builder-container {
            border: 1px solid #eee;
            border-radius: 6px;
            padding: 15px;
            background: #fdfdfd;
        }
        
        .list-builder-controls {
            display: flex;
            gap: 10px;
            align-items: flex-start;
        }
        
        .list-builder-controls select {
            flex-grow: 1;
        }

        .add-button {
            background-color: #5cb85c;
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
            white-space: nowrap;
        }
        
        .add-button:hover {
            background-color: #4cae4c;
        }

        .item-list {
            list-style: none;
            padding-left: 0;
            margin-top: 5px; 
            margin-bottom: 15px;
        }

        .item-list li {
            background: #f4f4f4;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 4px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.95rem;
        }

        .remove-item {
            font-family: Arial, sans-serif;
            font-weight: bold;
            color: var(--primary-color);
            background: #fff;
            border: 1px solid var(--primary-color);
            border-radius: 50%;
            width: 22px;
            height: 22px;
            line-height: 20px;
            text-align: center;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            margin-left: 10px;
        }
        
        .remove-item:hover {
            background-color: var(--primary-color);
            color: white;
        }
        
        .lainnya-input {
            width: 100%;
            margin-top: 10px;
            display: none; 
        }

        /* Tombol Lokasi */
        .location-button {
            width: 100%;
            background-color: var(--secondary-color);
            color: white;
            border: none;
            border-radius: 6px;
            padding: 12px 15px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .location-button:hover:not(:disabled) {
            background-color: #0056b3;
        }
        .location-button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }
        .location-button i {
            margin-right: 8px;
        }
        .location-status-message {
            font-size: 0.9rem;
            text-align: center;
            margin-top: 10px;
            font-weight: 500;
        }

        /* Tombol Submit Utama */
        .submit-button {
            background-color: var(--primary-color);
            color: white;
            padding: 14px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            width: 100%;
            font-size: 1.1rem;
            font-weight: 600;
            transition: background-color 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .submit-button:hover:not(:disabled) {
            background-color: #c9302c;
        }

        .submit-button:disabled {
            background-color: #aaa;
            cursor: not-allowed;
        }

        /* Overlay */
        .loading-overlay {
            display: none; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.85);
            z-index: 999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }

        .spinner {
            border: 8px solid #f3f3f3;
            border-top: 8px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
        }

        .loading-overlay p {
            margin-top: 20px;
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--primary-color);
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        #statusMessage {
            margin-top: -15px;
            margin-bottom: 20px;
            padding: 15px;
            border-radius: 6px;
            font-size: 1rem;
            font-weight: 500;
            display: none;
            text-align: center;
        }
        
        #statusMessage.sukses {
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
            display: block;
        }
        
        #statusMessage.gagal {
            background-color: #f2dede;
            color: #a94442;
            border: 1px solid #ebccd1;
            display: block;
        }

    </style>
</head>
<body>

    <h1>Formulir Asesmen JITUPASNA</h1>
    <div id="statusMessage"></div>

    <form id="assessmentForm">
        
        <div class="card">
            <div class="card-header">File Disposisi (Opsional)</div>
            <div class="form-group">
                <label for="fileDisposisi">Upload File Disposisi (PDF)</label>
                <input type="file" id="fileDisposisi" name="fileDisposisi">
            </div>
        </div>

        <div class="card">
            <div class="card-header">Data Bencana & Terdampak</div>
            
            <div class="form-group" style="display:none;">
                <label for="bencana">Deskripsi Bencana (Internal)</label>
                <input type="text" id="bencana" name="bencana" placeholder="Contoh: Tanah Longsor di Dsn. Krajan">
            </div>

            <div class="form-group">
                <label for="jenisBencana">Bencana</label>
                <select id="jenisBencana" name="jenisBencana">
                    <option value="">Pilih...</option>
                    <option value="Angin Kencang">Angin Kencang</option>
                    <option value="Banjir">Banjir</option>
                    <option value="Kebakaran">Kebakaran</option>
                    <option value="Gempa Bumi">Gempa Bumi</option>
                    <option value="Gunung Meletus">Gunung Meletus</option>
                    <option value="Tsunami">Tsunami</option>
                    <option value="Tanah Longsor">Tanah Longsor</option>
                </select>
            </div>

            <div class="form-group">
                <label for="sektor">Sektor JITUPASNA</label>
                <select id="sektor" name="sektor">
                    <option value="">Pilih Sektor...</option>
                    <option value="Perumahan dan Permukiman">Perumahan dan Permukiman</option>
                    <option value="Infrastruktur Pembangunan">Infrastruktur Pembangunan</option>
                    <option value="Ekonomi">Ekonomi</option>
                    <option value="Sosial dan Kemanusiaan">Sosial dan Kemanusiaan</option>
                    <option value="Lintas Sektor">Lintas Sektor</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="subSektor">Sub Sektor</label>
                <select id="subSektor" name="subSektor" disabled>
                    <option value="">Pilih Sektor Dulu...</option>
                </select>
            </div>

            <div class="form-group">
                <label for="namaKK">Nama Kepala Keluarga</label>
                <input type="text" id="namaKK" name="namaKK" placeholder="Masukkan nama...">
            </div>
            <div class="form-group">
                <label for="jumlahKeluarga">Jumlah Anggota Keluarga</label>
                <input type="number" id="jumlahKeluarga" name="jumlahKeluarga" placeholder="Masukkan jumlah...">
            </div>
            
            <div class="form-group">
                <label for="statusRumah">Status Rumah</label>
                <select id="statusRumah" name="statusRumah">
                    <option value="">Pilih...</option>
                    <option value="Milik Sendiri">Milik Sendiri</option>
                    <option value="Sewa">Sewa</option>
                </select>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Alamat & Lokasi</div>
            <div class="form-group">
                <label for="tempatTinggalSementara">Tempat Tinggal Sementara</label>
                <input type="text" id="tempatTinggalSementara" name="tempatTinggalSementara" placeholder="Contoh: Rumah Kerabat / Pos Pengungsian / ...">
            </div>
            <div class="form-group">
                <label for="jalanDusun">Jalan/Dusun</label>
                <input type="text" id="jalanDusun" name="jalanDusun" placeholder="Contoh: Dusun Krajan / Jalan Jawa / ...">
            </div>
            <div class="form-group">
                <label for="rt">RT</label>
                <input type="text" id="rt" name="rt" placeholder="Contoh: 001">
            </div>
            <div class="form-group">
                <label for="rw">RW</label>
                <input type="text" id="rw" name="rw" placeholder="Contoh: 005">
            </div>

            <div class="form-group">
                <label for="alamatKecamatan">Kecamatan</label>
                <select id="alamatKecamatan" name="alamatKecamatan">
                    <option value="">Pilih Kecamatan...</option>
                    </select>
            </div>
            
            <div class="form-group">
                <label for="alamatDesa">Kelurahan/Desa</label>
                <select id="alamatDesa" name="alamatDesa" disabled>
                    <option value="">Pilih Kecamatan Dulu...</option>
                    </select>
            </div>

            <div class="form-group">
                <label for="latitude">Latitude</label>
                <input type="text" id="latitude" name="latitude" placeholder="Klik tombol di bawah untuk mengisi">
            </div>
            <div class="form-group">
                <label for="longitude">Longitude</label>
                <input type="text" id="longitude" name="longitude" placeholder="Klik tombol di bawah untuk mengisi">
            </div>
            <div class="form-group">
                <button type="button" id="getLocationBtn" class="location-button">
                    <i class="fas fa-location-arrow"></i> Deteksi Lokasi
                </button>
                <div id="locationStatus" class="location-status-message"></div>
            </div>
            <div class="form-group">
                <label for="nomoryangBisaDihubungi">Nomor yang Bisa Dihubungi</label>
                <input type="tel" id="nomoryangBisaDihubungi" name="nomoryangBisaDihubungi" placeholder="Contoh: 08123456789">
            </div>
        </div>
        <div class="card">
            <div class="card-header">Data Kerusakan</div>
            <div class="form-group">
                <label for="ukuranPanjang">Ukuran Kerusakan (Panjang)</label>
                <label class="note">Dalam satuan meter. Isi angka saja.</label>
                <input type="number" step="0.1" id="ukuranPanjang" name="ukuranPanjang" placeholder="Contoh: 10,5">
            </div>
            <div class="form-group">
                <label for="ukuranLebar">Ukuran Kerusakan (Lebar)</label>
                <label class="note">Dalam satuan meter. Isi angka saja.</label>
                <input type="number" step="0.1" id="ukuranLebar" name="ukuranLebar" placeholder="Contoh: 8">
            </div>
            <div class="form-group">
                <label for="jenisKonstruksi">Jenis Konstruksi</label>
                <select id="jenisKonstruksi" name="jenisKonstruksi">
                    <option value="">Pilih...</option>
                    <option value="Permanen">Permanen</option>
                    <option value="Semi Permanen">Semi Permanen</option>
                    <option value="Non Mermanen">Non Permanen</option>
                </select>
            </div>

            <div class="form-group list-builder-container">
                <label for="bagianKerusakanSelect">Bagian yang mengalami kerusakan</label>
                <ul id="bagianKerusakanListContainer" class="item-list"></ul>
                <div class="list-builder-controls">
                    <select id="bagianKerusakanSelect" class="list-builder-select">
                        <option value="">Pilih bagian...</option>
                        <option value="Atap">Atap</option>
                        <option value="Dinding">Dinding</option>
                        <option value="Lantai">Lantai</option>
                        <option value="Pondasi">Pondasi</option>
                    </select>
                    <button type="button" id="bagianKerusakanButton" class="add-button">Tambahkan</button>
                </div>
                <input type="text" id="bagianKerusakanLainnyaInput" class="lainnya-input" placeholder="Ketik bagian lainnya...">
                <input type="hidden" id="bagianKerusakan" name="bagianKerusakan">
            </div>

            <div class="form-group kerusakan-fisik-group" data-category="Pondasi">
                <label for="kerusakanPondasi">Kerusakan Fisik Pondasi</label>
                <select id="kerusakanPondasi" name="kerusakanPondasi">
                    <option value="">Pilih...</option>
                    <option value="Retakan sangat jelas namun tidak tembus sampai tulang beton (6%)">Retakan sangat jelas namun tidak tembus sampai tulang beton (6%)</option>
                    <option value="Kehancuran beton yang sangat nyata dengan tulangan beton terlihat (6%)">Kehancuran beton yang sangat nyata dengan tulangan beton terlihat (6%)</option>
                    <option value="Penurunan dan atau Kemiringan lantai dapat terlihat (8%)">Penurunan dan atau Kemiringan lantai dapat terlihat (8%)</option>
                    <option value="Pondasi hancur dan atau tidak bisa diperbaiki (10%)">Pondasi hancur dan atau tidak bisa diperbaiki (10%)</option>
                </select>
            </div>
            
            <div class="form-group kerusakan-fisik-group" data-category="Dinding">
                <label for="kerusakanRangkaStruktur">Kerusakan Fisik Rangka Struktur (Kolom/Balok)</label>
                <select id="kerusakanRangkaStruktur" name="kerusakanRangkaStruktur">
                    <option value="">Pilih...</option>
                    <option value="Retakan yang sangat jelas namun tidak tembus sampai tulangan beton (10%)">Retakan yang sangat jelas namun tidak tembus sampai tulangan beton (10%)</option>
                    <option value="Kehancuran beton yang sangat nyata dengan tulangan beton terlihat (10%)">Kehancuran beton yang sangat nyata dengan tulangan beton terlihat (10%)</option>
                    <option value="Tulangan tertekuk (15%)">Tulangan tertekuk (15%)</option>
                    <option value="Deformasi vertikal/miring pada kolom dapat terlihat (25%)">Deformasi vertikal/miring pada kolom dapat terlihat (25%)</option>
                    <option value="Rangka struktur kayu rusak/roboh (25%)">Rangka struktur kayu rusak/roboh (25%)</option>
                </select>
            </div>
            
            <div class="form-group kerusakan-fisik-group" data-category="Atap">
                <label for="kerusakanRangkaAtap">Kerusakan Fisik Rangka Atap/Kuda-Kuda</label>
                <select id="kerusakanRangkaAtap" name="kerusakanRangkaAtap">
                    <option value="">Pilih...</option>
                    <option value="Reng dan/atau usuk hancur sebagian atau seluruh (10%)">Reng dan/atau usuk hancur sebagian atau seluruh (10%)</option>
                    <option value="Kuda-kuda roboh sebagian atau seluruh (25%)">Kuda-kuda roboh sebagian atau seluruh (25%)</option>
                </select>
            </div>

            <div class="form-group kerusakan-fisik-group" data-category="Atap">
                <label for="kerusakanPenutupAtap">Kerusakan Penutup Atap/Genteng</label>
                <select id="kerusakanPenutupAtap" name="kerusakanPenutupAtap">
                    <option value="">Pilih...</option>
                    <option value="Berjatuhan menyebar sebagian atau seluruh (5%)">Berjatuhan menyebar sebagian atau seluruh (5%)</option>
                </select>
            </div>

            <div class="form-group kerusakan-fisik-group" data-category="Atap">
                <label for="kerusakanLangit">Kerusakan Fisik Langit-Langit/Plafon</label>
                <select id="kerusakanLangit" name="kerusakanLangit">
                    <option value="">Pilih...</option>
                    <option value="Langit-langit terlepas/jatuh menyebar sebagian atau seluruh (5%)">Langit-langit terlepas/jatuh menyebar sebagian atau seluruh (5%)</option>
                    <option value="Langit-langit terlepas/jatuh dan rangka langit-langit rusak menyebar sebagian atau seluruh (5%)">Langit-langit terlepas/jatuh dan rangka langit-langit rusak menyebar sebagian atau seluruh (5%)</option>
                </select>
            </div>

            <div class="form-group kerusakan-fisik-group" data-category="Dinding">
                <label for="kerusakanDinding">Kerusakan Fisik Dinding</label>
                <select id="kerusakanDinding" name="kerusakanDinding">
                    <option value="">Pilih...</option>
                    <option value="Plesteran terkelupas (10%)">Plesteran terkelupas (10%)</option>
                    <option value="Retakan dapat terlihat jelas, tembus pada pasangan batu (10%)">Retakan dapat terlihat jelas, tembus pada pasangan batu (10%)</option>
                    <option value="Dinding mengalami displacement horizontal/iring (17%)">Dinding mengalami displacement horizontal/iring (17%)</option>
                    <option value="Dinding jatuh sebagian atau menyeluruh (25%)">Dinding jatuh sebagian atau menyeluruh (25%)</option>
                    <option value="Dinding partisi/sesek rusak sebagian/menyeluruh (25%)">Dinding partisi/sesek rusak sebagian/menyeluruh (25%)</option>
                </select>
            </div>

            <div class="form-group kerusakan-fisik-group" data-category="Lantai">
                <label for="kerusakanLantai">Kerusakan Fisik Lantai</label>
                <select id="kerusakanLantai" name="kerusakanLantai">
                    <option value="">Pilih...</option>
                    <option value="Retak dan/atau hancur menyebar sebagian atau seluruh (5%)">Retak dan/atau hancur menyebar sebagian atau seluruh (5%)</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="nilaiKerugian">Nilai Kerugian</label>
                <label class="note">Isi angka saja. Contoh: 5000000</label>
                <input type="number" id="nilaiKerugian" name="nilaiKerugian" placeholder="Estimasi nilai rupiah...">
            </div>

            <div class="form-group">
                <label for="pengkajianDampak">Pengkajian Dampak</label>
                <textarea id="pengkajianDampak" name="pengkajianDampak" placeholder="Deskripsikan dampak yang terjadi..."></textarea>
            </div>
        </div>

        <div class="card">
            <div class="card-header">Bantuan yang Diajukan untuk Diserahkan</div>
            <label class="note">Tulis jumlahnya saja (angka).</label>
            <div class="form-group">
                <label for="semen">Semen</label>
                <input type="number" id="semen" name="semen" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="batuBata">Batu Bata</label>
                <input type="number" id="batuBata" name="batuBata" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="genteng">Genteng</label>
                <input type="number" id="genteng" name="genteng" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="kalsiboard">Kalsiboard</label>
                <input type="number" id="kalsiboard" name="kalsiboard" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="kayuBalok">Kayu Balok</label>
                <input type="number" id="kayuBalok" name="kayuBalok" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="kayuUsuk">Kayu Usuk</label>
                <input type="number" id="kayuUsuk" name="kayuUsuk" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="kayuReng">Kayu Reng</label>
                <input type="number" id="kayuReng" name="kayuReng" placeholder="Jumlah...">
            </div>
            
            <div class="form-group">
                <label for="besi6mm">Besi ፀ 6 m</label>
                <input type="number" id="besi6mm" name="besi6mm" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="besi10mm">Besi ፀ 10 mm</label>
                <input type="number" id="besi10mm" name="besi10mm" placeholder="Jumlah...">
            </div>

            <div class="form-group">
                <label for="terpal3x4">Terpal 3 × 4m</label>
                <input type="number" id="terpal3x4" name="terpal3x4" placeholder="Jumlah...">
            </div>
            <div class="form-group">
                <label for="terpal5x6">Terpal 5 × 6m</label>
                <input type="number" id="terpal5x6" name="terpal5x6" placeholder="Jumlah...">
            </div>
        </div>

        <div class="card">
            <div class="card-header">Personil & Unsur Terlibat</div>
            
            <div class="form-group list-builder-container">
                <label for="personilSelect">Personil yang Berangkat</label>
                <ul id="personilListContainer" class="item-list"></ul>
                <div class="list-builder-controls">
                    <select id="personilSelect" class="list-builder-select">
                        <option value="">Pilih personil...</option>
                        <option value="Ir. Anang Dwi Resdianto, S.T., M.M., M.T.">Ir. Anang Dwi Resdianto, S.T., M.M., M.T.</option>
                        <option value="Raden Waloejo Djati, S.T.">Raden Waloejo Djati, S.T.</option>
                        <option value="Anton">Anton</option>
                        <option value="Cahyani Wulandari, S.T.">Cahyani Wulandari, S.T.</option>
                        <option value="Yangga Purnagusti, S.T.">Yangga Purnagusti, S.T.</option>
                        <option value="Muhammad Qoidul Umam, S.T.">Muhammad Qoidul Umam, S.T.</option>
                        <option value="Risky Rena Anggia Sari, S.T.">Risky Rena Anggia Sari, S.T.</option>
                        <option value="Deliana Aristantia, S.Pd.">Deliana Aristantia, S.Pd.</option>
                        <option value="Ali Maskur Bakri">Ali Maskur Bakri</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                    <button type="button" id="personilButton" class="add-button">Tambahkan</button>
                </div>
                <input type="text" id="personilLainnyaInput" class="lainnya-input" placeholder="Ketik nama personil lainnya...">
                <input type="hidden" id="personilyangBerangkat" name="personilyangBerangkat">
                <input type="hidden" id="personilLainnya" name="personilLainnya">
            </div>

            <div class="form-group list-builder-container">
                <label for="unsurSelect">Unsur yang Terlibat</label>
                <ul id="unsurListContainer" class="item-list"></ul>
                <div class="list-builder-controls">
                    <select id="unsurSelect" class="list-builder-select">
                        <option value="">Pilih unsur...</option>
                        <option value="BPBD Kabupaten Jember">BPBD Kabupaten Jember</option>
                        <option value="Perangkat Kelurahan/Desa">Perangkat Kelurahan/Desa</option>
                        <option value="TNI/POLRI">TNI/POLRI</option>
                        <option value="Warga">Warga</option>
                        <option value="Relawan">Relawan</option>
                        <option value="Lainnya">Lainnya</option>
                    </select>
                    <button type="button" id="unsurButton" class="add-button">Tambahkan</button>
                </div>
                <input type="text" id="unsurLainnyaInput" class="lainnya-input" placeholder="Ketik unsur lainnya...">
                <input type="hidden" id="unsuryangTerlibat" name="unsuryangTerlibat">
                <input type="hidden" id="unsurLainnya" name="unsurLainnya">
            </div>
        </div>

        <div class="card">
            <div class="card-header">Dokumentasi (Opsional)</div>
            <div class="form-group">
                <label for="filesDokumentasi">Upload Foto Dokumentasi (Bisa lebih dari 1, maks 8 foto)</label>
                <input type="file" id="filesDokumentasi" name="filesDokumentasi" multiple accept="image/*,.jpeg,.jpg,.png">
            </div>
        </div>

        <button type="submit" id="submitButton" class="submit-button">Kirim Laporan</button>

    </form>

    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
        <p>Mengirim data dan mengupload file... <br>Harap tunggu, ini mungkin perlu waktu beberapa saat.</p>
    </div>


    <script>
        // -----------------------------------------------------------------
        // (WAJIB) GANTI DENGAN URL WEB APP ANDA
        // -----------------------------------------------------------------
        const GAS_WEB_APP_URL = "https://script.google.com/macros/s/AKfycby_g8FExlZMnXvPbZm0oBKXo7VVnyvDtpcQDQ6sLd59vsqjw2LLyzCuZvJ_pIPXvL1z/exec"; // <-- GANTI INI


        // --- Variabel Global ---
        const form = document.getElementById('assessmentForm');
        const submitButton = document.getElementById('submitButton');
        const loadingOverlay = document.getElementById('loadingOverlay');
        const statusMessage = document.getElementById('statusMessage');


        // ========================================================
        // JAVASCRIPT BARU UNTUK DROPDOWN KECAMATAN/DESA
        // ========================================================
        
        // Data diambil dari file PDF yang Anda berikan [cite: 5, 6, 7, 8, 9, 10, 11]
        const dataJember = {
            "Ajung": ["Ajung", "Klompangan", "Mangaran", "Pancakarya", "Rowoindah", "Sukamakmur", "Wirowongso"],
            "Ambulu": ["Ambulu", "Andongsari", "Karang Anyar", "Pontang", "Sabrang", "Sumberejo", "Tegalsari"],
            "Arjasa": ["Arjasa", "Biting", "Candijati", "Darsono", "Kamal", "Kemuning Lor"],
            "Bangsalsari": ["Badean", "Bangsalsari", "Banjarsari", "Curahkalong", "Gambirono", "Karangsono", "Langkap", "Petung", "Sukorejo", "Tisnogambar", "Tugusari"],
            "Balung": ["Balung Kidul", "Balung Kulon", "Balung Lor", "Curahlele", "Gumelar", "Karangduren", "Karang Semanding", "Tutul"],
            "Gumukmas": ["Bagorejo", "Gumukmas", "Karangrejo", "Kepanjen", "Mayangan", "Menampu", "Purwoasri", "Tembokrejo"],
            "Jelbuk": ["Jelbuk", "Panduman", "Sucopangepok", "Sugerkidul", "Sukojember", "Sukowiryo"],
            "Jenggawah": ["Jatisari", "Jenggawah", "Kemuningsari Kidul", "Cangkring", "Jatimulyo", "Kertonegoro", "Sruni", "Wonojati"],
            "Jombang": ["Jombang", "Keting", "Ngampelrejo", "Padomasan", "Sarimulyo", "Wringinagung"],
            "Kalisat": ["Ajung", "Gambiran", "Glagahwero", "Gumuksari", "Kalisat", "Patempuran", "Plalangan", "Sebanen", "Sukoreno", "Sumberjeruk", "Sumberkalong", "Sumberketempa"],
            "Kaliwates": ["Jember Kidul", "Kaliwates", "Kebon Agung", "Kepatihan", "Mangli", "Sempusari", "Tegal Besar"],
            "Kencong": ["Cakru", "Kencong", "Kraton", "Paseban", "Wonorejo"],
            "Ledokombo": ["Karangpaiton", "Ledokombo", "Lembengan", "Slateng", "Sukogidri", "Sumberanget", "Sumberbulus", "Sumberlesung", "Sumbersalak", "Suren"],
            "Mayang": ["Mayang", "Mrawan", "Seputih", "Sidomukti", "Sumberkejayan", "Tegalwaru", "Tegalrejo"],
            "Mumbulsari": ["Karang Kedawung", "Kawangrejo", "Lampeji", "Lengkong", "Mumbulsari", "Suco", "Tamansari"],
            "Panti": ["Glagahwero", "Kemiri", "Kemuningsari Lor", "Pakis", "Panti", "Serut", "Suci"],
            "Pakusari": ["Bedadung", "Jatian", "Kertosari", "Pakusari", "Patemon", "Subo", "Sumberpinang"],
            "Patrang": ["Banjarsengon", "Baratan", "Bintoro", "Gebang", "Jemberlor", "Jumerto", "Patrang", "Slawu"],
            "Puger": ["Bagon", "Grenden", "Jambearum", "Kasiyan", "Kasiyan Timur", "Mlokorejo", "Mojomulyo", "Mojosari", "Puger Kulon", "Puger Wetan", "Wonosari", "Wringintelu"],
            "Rambipuji": ["Curahmalang", "Gugut", "Kaliwining", "Nogosari", "Pecoro", "Rambigundam", "Rambipuji", "Rowotamtu"],
            "Semboro": ["Pondokdalem", "Pondokjoyo", "Rejoagung", "Semboro", "Sidomekar", "Sidomulyo"],
            "Silo": ["Garahan", "Harjomulyo", "Karangharjo", "Mulyorejo", "Pace", "Sempolan", "Sidomulyo", "Silo", "Sumberjati"],
            "Sukorambi": ["Dukuhmencek", "Jubung", "Karangpring", "Klungkung", "Sukorambi"],
            "Sukowono": ["Arjasa", "Balet Baru", "Dawuhanmangli", "Mojogemi", "Pocangan", "Sukokerto", "Sukorejo", "Sukosari", "Sukowono", "Sumberwringin", "Sumberdanti", "Sumberwaru"],
            "Sumberbaru": ["Gelang", "Jambesari", "Jamintoro", "Jatiroto", "Kaliglagah", "Karangbayat", "Pringgowirawan", "Rowotengah", "Sumberagung", "Yosorati"],
            "Sumberjambe": ["Cumedak", "Gunungmalang", "Jambearum", "Plerean", "Pringgondani", "Randuagung", "Rowosari", "Sumberjambe", "Sumberpakem"],
            "Sumbersari": ["Antirogo", "Karangrejo", "Kebonsari", "Kranjingan", "Sumbersari", "Tegalgede", "Wirolegi"],
            "Tanggul": ["Darungan", "Klatakan", "Kramat Sukoharjo", "Manggisan", "Patemon", "Selodakon", "Tanggul Kulon", "Tanggul Wetan"],
            "Tempurejo": ["Andongrejo", "Curahnongko", "Curahtakir", "Pondokrejo", "Sidodadi", "Sanenrejo", "Tempurejo", "Wonoasri"],
            "Umbulsari": ["Gadingrejo", "Gunungsari", "Mundurejo", "Paleran", "Sidorejo", "Sukoreno", "Tanjungsari", "Tegalwangi", "Umbulrejo", "Umbulsari"],
            "Wuluhan": ["Ampel", "Dukuhdempok", "Glundengan", "Kesilir", "Lojejer", "Tamansari", "Tanjungrejo"]
        };

	// ========================================================
        // JAVASCRIPT BARU UNTUK DROPDOWN SEKTOR/SUBSEKTOR
        // ========================================================
        const dataSektor = {
            "Perumahan dan Permukiman": [
                "Perumahan", 
                "Prasarana Lingkungan Perumahan", 
                "Prasarana Sosial Masyarakat"
            ],
            "Infrastruktur Pembangunan": [
                "Transportasi Darat, Laut, dan Udara", 
                "Energi", 
                "Pos dan Telekomunikasi", 
                "Air dan Sanitasi", 
                "Pemerintahan Umum"
            ],
            "Ekonomi": [
                "Pertanian dan Peternakan", 
                "Perkebunan", 
                "Perikanan", 
                "Industri Kecil dan Menengah", 
                "Perdagangan", 
                "Pariwisata", 
                "Perbankan"
            ],
            "Sosial dan Kemanusiaan": [
                "Kesehatan", 
                "Pendidikan", 
                "Agama", 
                "Budaya", 
                "Perlindungan Sosial", 
                "Kependudukan", 
                "Ketahanan Pangan", 
                "Keamanan dan Ketertiban"
            ],
            "Lintas Sektor": [
                "Tata Kelola Pemerintahan", 
                "Lingkungan Hidup", 
                "Gender"
            ]
        };

        // Tambahkan event listener ini DI DALAM 'DOMContentLoaded'
        document.addEventListener('DOMContentLoaded', () => {
            // ... (kode dropdown kecamatan Anda sudah ada di sini) ...

            const sektorSelect = document.getElementById('sektor');
            const subSektorSelect = document.getElementById('subSektor');

            if (sektorSelect) {
                sektorSelect.addEventListener('change', () => {
                    const selectedSektor = sektorSelect.value;
                    subSektorSelect.innerHTML = ''; // Kosongkan pilihan lama

                    if (selectedSektor && dataSektor[selectedSektor]) {
                        // Jika Sektor dipilih, aktifkan dropdown Sub Sektor
                        subSektorSelect.disabled = false;
                        subSektorSelect.add(new Option('Pilih Sub Sektor...', ''));
                        
                        const subSektorList = dataSektor[selectedSektor]; // Ambil list
                        subSektorList.forEach(subSektor => {
                            subSektorSelect.add(new Option(subSektor, subSektor));
                        });
                    } else {
                        // Jika tidak ada Sektor dipilih, nonaktifkan
                        subSektorSelect.disabled = true;
                        subSektorSelect.add(new Option('Pilih Sektor Dulu...', ''));
                    }
                });
            }
        });

        // Menjalankan fungsi ini saat halaman selesai dimuat
        document.addEventListener('DOMContentLoaded', () => {
            const kecamatanSelect = document.getElementById('alamatKecamatan');
            const desaSelect = document.getElementById('alamatDesa');

            if (kecamatanSelect) {
                // 1. Isi Dropdown Kecamatan
                const kecamatanList = Object.keys(dataJember).sort();
                kecamatanList.forEach(kecamatan => {
                    kecamatanSelect.add(new Option(kecamatan, kecamatan));
                });

                // 2. Tambahkan Event Listener
                kecamatanSelect.addEventListener('change', () => {
                    const selectedKecamatan = kecamatanSelect.value;
                    desaSelect.innerHTML = ''; // Kosongkan pilihan lama

                    if (selectedKecamatan) {
                        // Jika Kecamatan dipilih, aktifkan dropdown Desa
                        desaSelect.disabled = false;
                        desaSelect.add(new Option('Pilih Kelurahan/Desa...', ''));
                        
                        const desaList = dataJember[selectedKecamatan].sort(); // Ambil & urutkan desa
                        desaList.forEach(desa => {
                            desaSelect.add(new Option(desa, desa));
                        });
                    } else {
                        // Jika tidak ada Kecamatan dipilih, nonaktifkan
                        desaSelect.disabled = true;
                        desaSelect.add(new Option('Pilih Kecamatan Dulu...', ''));
                    }
                });
            }
        });
        // ===========================================
        // AKHIR JAVASCRIPT BARU
        // ===========================================


        // ===========================================
        // JAVASCRIPT UNTUK GEOLOCATION (GPS)
        // ===========================================
        const getLocationBtn = document.getElementById('getLocationBtn');
        const locationStatus = document.getElementById('locationStatus');
        const latInput = document.getElementById('latitude');
        const lonInput = document.getElementById('longitude');

        getLocationBtn.addEventListener('click', getLocation);

        function getLocation() {
            if (navigator.geolocation) {
                getLocationBtn.disabled = true;
                locationStatus.innerHTML = '<i style="color:#007bff;">Mencari lokasi akurat... Harap tunggu.</i>';
                var options = { enableHighAccuracy: true, timeout: 20000, maximumAge: 0 };
                navigator.geolocation.getCurrentPosition(showPosition, showError, options);
            } else {
                locationStatus.innerHTML = '<b style="color:red;">Geolocation tidak didukung browser ini.</b>';
            }
        }

        function showPosition(position) {
            // Kita akan ubah formatnya menjadi KOMA
            const lat = position.coords.latitude.toFixed(7).replace('.', ',');
            const lon = position.coords.longitude.toFixed(7).replace('.', ',');
            
            // Masukkan nilai dengan format KOMA ke dalam input box
            latInput.value = lat; // Contoh: -7,9169373
            lonInput.value = lon; // Contoh: 113,8305265
            
            // Pesan status (ini sudah benar)
            locationStatus.innerHTML = `<b style="color:green;">✅ Lokasi berhasil terdeteksi!</b><br><small>Lat: ${lat}, Lon: ${lon}</small>`;
            getLocationBtn.disabled = false;
        }

        function showError(error) {
            let message = "Gagal mendapatkan lokasi. Pastikan Anda memberikan izin akses lokasi.";
            if (error.code == error.PERMISSION_DENIED) {
                 message = "Gagal, Anda menolak izin akses lokasi. Silakan izinkan di pengaturan browser.";
            } else if (error.code == error.POSITION_UNAVAILABLE) {
                message = "Gagal, informasi lokasi tidak tersedia dari HP/PC Anda.";
            } else if (error.code == error.TIMEOUT) {
                message = "Waktu permintaan habis. Coba lagi di tempat dengan sinyal lebih baik.";
            }
            locationStatus.innerHTML = `<b style="color:red;">${message}</b>`;
            getLocationBtn.disabled = false;
        }

	function updateKerusakanVisibility(category, show) {
            // Temukan semua pertanyaan yang relevan
            const allQuestions = document.querySelectorAll(`.kerusakan-fisik-group[data-category="${category}"]`);
            
            allQuestions.forEach(question => {
                question.style.display = show ? 'block' : 'none';
                
                // Jika disembunyikan, reset juga nilainya
                if (!show) {
                    const select = question.querySelector('select');
                    if (select) {
                        select.value = '';
                    }
                }
            });
        }
       
        // ===========================================
        // JAVASCRIPT UNTUK LIST BUILDER
        // ===========================================
        function setupListBuilder(prefix) {
            const selectEl = document.getElementById(prefix + 'Select');
            const lainnyaInputEl = document.getElementById(prefix + 'LainnyaInput');
            const addButtonEl = document.getElementById(prefix + 'Button'); 
            const listContainerEl = document.getElementById(prefix + 'ListContainer');

            if (!selectEl || !lainnyaInputEl || !addButtonEl || !listContainerEl) {
                console.warn('Elemen List Builder tidak ditemukan untuk prefix:', prefix);
                return;
            }

            selectEl.addEventListener('change', () => {
                if (selectEl.value === 'Lainnya') {
                    lainnyaInputEl.style.display = 'block';
                    lainnyaInputEl.focus();
                } else {
                    lainnyaInputEl.style.display = 'none';
                    lainnyaInputEl.value = '';
                }
            });

	    lainnyaInputEl.addEventListener('keydown', (event) => {
            if (event.key === 'Enter') {
            // 1. Hentikan aksi default (submit form)
            event.preventDefault(); 
            // 2. Jalankan aksi klik tombol "Tambahkan"
            addButtonEl.click(); 
                }
   	    });

            addButtonEl.addEventListener('click', () => {
                let valueToAdd = '';
                let type = ''; 
                
                if (selectEl.value === 'Lainnya') {
                    valueToAdd = lainnyaInputEl.value.trim();
                    type = 'lainnya';
                } else if (selectEl.value) {
                    valueToAdd = selectEl.value;
                    type = 'predefined';
                }

                if (!valueToAdd) {
                    alert('Silakan pilih atau isi nama terlebih dahulu.');
                    return;
                }

                const existingItems = listContainerEl.querySelectorAll('li');
                for (let item of existingItems) {
                    if (item.dataset.value.toLowerCase() === valueToAdd.toLowerCase()) {
                        alert('Item ini sudah ditambahkan.');
                        return;
                    }
                }

                const li = document.createElement('li');
                li.dataset.value = valueToAdd; 
                li.dataset.type = type; 

                const textNode = document.createTextNode(valueToAdd);
                const removeButton = document.createElement('span');
                removeButton.className = 'remove-item';
                removeButton.innerHTML = '&times;';
                const contentWrapper = document.createElement('div');
                contentWrapper.appendChild(textNode);
                const buttonWrapper = document.createElement('div');
                buttonWrapper.appendChild(removeButton);
                li.appendChild(contentWrapper);
                li.appendChild(buttonWrapper);

                removeButton.addEventListener('click', () => {
                    li.remove();
                    updateHiddenInputs(prefix);
		    if (prefix === 'bagianKerusakan') {
                        // Saat item dihapus, sembunyikan pertanyaannya
                        updateKerusakanVisibility(li.dataset.value, false);
                    } 
                });

                listContainerEl.appendChild(li);
                updateHiddenInputs(prefix);
		if (prefix === 'bagianKerusakan') {
                    // Saat item ditambah, tampilkan pertanyaannya
                    updateKerusakanVisibility(valueToAdd, true);
                }

                selectEl.value = '';
                lainnyaInputEl.style.display = 'none';
                lainnyaInputEl.value = '';
            });
        }
        
        function updateHiddenInputs(prefix) {
            const listContainerEl = document.getElementById(prefix + 'ListContainer');
            if (!listContainerEl) return;
            
            const allItems = listContainerEl.querySelectorAll('li');
            
            if (prefix === 'bagianKerusakan') {
                const allValues = [];
                allItems.forEach(li => {
                    allValues.push(li.dataset.value);
                });
                document.getElementById('bagianKerusakan').value = allValues.join(', ');
            
            } else {
                const predefinedValues = [];
                const lainnyaValues = [];

                allItems.forEach(li => {
                    if (li.dataset.type === 'predefined') {
                        predefinedValues.push(li.dataset.value);
                    } else if (li.dataset.type === 'lainnya') {
                        lainnyaValues.push(li.dataset.value);
                    }
                });

                let hiddenPredefinedId = '';
                let hiddenLainnyaId = '';

                if (prefix === 'personil') {
                    hiddenPredefinedId = 'personilyangBerangkat';
                    hiddenLainnyaId = 'personilLainnya';
                } else if (prefix === 'unsur') {
                    hiddenPredefinedId = 'unsuryangTerlibat';
                    hiddenLainnyaId = 'unsurLainnya';
                }
                
                if (hiddenPredefinedId) {
                    document.getElementById(hiddenPredefinedId).value = predefinedValues.join(', ');
                    document.getElementById(hiddenLainnyaId).value = lainnyaValues.join(', ');
                }
            }
        }

        // Inisialisasi semua list builder
        setupListBuilder('personil');
        setupListBuilder('unsur');
        setupListBuilder('bagianKerusakan');
        
        // ===========================================
        // --- Logika Submit Form ---
        // ===========================================

        form.addEventListener('submit', handleFormSubmit);

        // --- GANTI FUNGSI LAMA ANDA DENGAN YANG INI ---
async function handleFormSubmit(e) {
    e.preventDefault();

    const namaKK = document.getElementById('namaKK').value;
    const alamatDesa = document.getElementById('alamatDesa').value;
    if (!namaKK && !alamatDesa) {
        if (!confirm('Nama KK dan Desa masih kosong. Yakin ingin mengirim laporan kosong?')) {
            return; 
        }
    }

    loadingOverlay.style.display = 'flex';
    submitButton.disabled = true;
    statusMessage.style.display = 'none';

    try {
        const formData = await createFormDataObject();

        if (formData.filesDokumentasi.length > 8) {
            throw new Error("Gagal: Anda hanya dapat meng-upload maksimal 8 file dokumentasi.");
        }

        // ===============================================
        // INI ADALAH PERUBAHAN DARI SOLUSI ANDA
        // ===============================================
        await fetch(GAS_WEB_APP_URL, {
            method: 'POST',
            mode: 'no-cors', // <-- 1. TAMBAHKAN MODE 'no-cors'
            body: JSON.stringify(formData),
            headers: {
                'Content-Type': 'text/plain;charset=utf-8', // <-- 2. TETAP GUNAKAN text/plain
            },
        });
        // ===============================================
        // AKHIR PERUBAHAN
        // ===============================================

        // KARENA 'no-cors' TIDAK BISA MEMBACA BALASAN,
        // KITA HARUS BERASUMSI PENGIRIMAN BERHASIL.
        
        // Kita tidak bisa lagi memeriksa 'result.status' dari server.
        // Kita langsung tampilkan sukses dan reset form.
        showStatus('Data Anda telah dikirim! (Mode: no-cors)', 'sukses');
        form.reset();
        
        // Reset semua list
        if(document.getElementById('personilListContainer')) document.getElementById('personilListContainer').innerHTML = '';
        if(document.getElementById('unsurListContainer')) document.getElementById('unsurListContainer').innerHTML = '';
        if(document.getElementById('bagianKerusakanListContainer')) document.getElementById('bagianKerusakanListContainer').innerHTML = '';
        if(document.getElementById('locationStatus')) document.getElementById('locationStatus').innerHTML = ''; 
        // Update input tersembunyi jadi kosong
        updateHiddenInputs('personil'); 
        updateHiddenInputs('unsur');
        updateHiddenInputs('bagianKerusakan');

	    document.querySelectorAll('.kerusakan-fisik-group').forEach(q => {
                        q.style.display = 'none';
                    });

        // Reset dropdown desa
        const desaSelect = document.getElementById('alamatDesa');
        if (desaSelect) {
            desaSelect.innerHTML = '<option value="">Pilih Kecamatan Dulu...</option>';
            desaSelect.disabled = true;
        }

	const subSektorSelect = document.getElementById('subSektor');
        if (subSektorSelect) {
            subSektorSelect.innerHTML = '<option value="">Pilih Sektor Dulu...</option>';
            subSektorSelect.disabled = true;
        }

    } catch (error) {
        // Error ini kemungkinan besar adalah error JARINGAN, 
        // BUKAN error balasan dari server.
        console.error('Error:', error);
        showStatus(`Terjadi Gagal (Lokal): ${error.message}`, 'gagal');
    } finally {
        loadingOverlay.style.display = 'none';
        submitButton.disabled = false;
    }
}
// --- AKHIR PENGGANTIAN FUNGSI ---

        async function createFormDataObject() {
            const formData = {};
            formData.mode = "baru";

            // Kumpulkan Data Teks, Angka, dan Pilihan
            formData.bencana = document.getElementById('bencana').value;
            formData.jenisBencana = document.getElementById('jenisBencana').value;
            formData.sektor = document.getElementById('sektor').value;
            formData.subSektor = document.getElementById('subSektor').value;
            formData.namaKK = document.getElementById('namaKK').value;
            formData.jumlahKeluarga = document.getElementById('jumlahKeluarga').value;
            formData.statusRumah = document.getElementById('statusRumah').value;
            formData.tempatTinggalSementara = document.getElementById('tempatTinggalSementara').value;
            formData.jalanDusun = document.getElementById('jalanDusun').value;
            formData.rt = document.getElementById('rt').value;
            formData.rw = document.getElementById('rw').value;
            formData.alamatDesa = document.getElementById('alamatDesa').value;
            formData.alamatKecamatan = document.getElementById('alamatKecamatan').value;
            formData.latitude = document.getElementById('latitude').value;
            formData.longitude = document.getElementById('longitude').value;
            formData.nomoryangBisaDihubungi = document.getElementById('nomoryangBisaDihubungi').value;
            formData.ukuranPanjang = document.getElementById('ukuranPanjang').value;
            formData.ukuranLebar = document.getElementById('ukuranLebar').value;
            formData.jenisKonstruksi = document.getElementById('jenisKonstruksi').value;
            formData.kerusakanPondasi = document.getElementById('kerusakanPondasi').value;
            formData.kerusakanRangkaStruktur = document.getElementById('kerusakanRangkaStruktur').value;
            formData.kerusakanRangkaAtap = document.getElementById('kerusakanRangkaAtap').value;
            formData.kerusakanPenutupAtap = document.getElementById('kerusakanPenutupAtap').value;
            formData.kerusakanLangit = document.getElementById('kerusakanLangit').value;
            formData.kerusakanDinding = document.getElementById('kerusakanDinding').value;
            formData.kerusakanLantai = document.getElementById('kerusakanLantai').value;
            formData.nilaiKerugian = document.getElementById('nilaiKerugian').value;
            formData.pengkajianDampak = document.getElementById('pengkajianDampak').value;
            formData.semen = document.getElementById('semen').value;
            formData.batuBata = document.getElementById('batuBata').value;
            formData.genteng = document.getElementById('genteng').value;
            formData.kalsiboard = document.getElementById('kalsiboard').value;
            formData.kayuBalok = document.getElementById('kayuBalok').value;
            formData.kayuUsuk = document.getElementById('kayuUsuk').value;
            formData.kayuReng = document.getElementById('kayuReng').value;
            formData.besi6mm = document.getElementById('besi6mm').value;
            formData.besi10mm = document.getElementById('besi10mm').value;
            formData.terpal3x4 = document.getElementById('terpal3x4').value;
            formData.terpal5x6 = document.getElementById('terpal5x6').value;
            
            // Data dari list builder
            formData.bagianKerusakan = document.getElementById('bagianKerusakan').value;
            formData.personilyangBerangkat = document.getElementById('personilyangBerangkat').value;
            formData.personilLainnya = document.getElementById('personilLainnya').value;
            formData.unsuryangTerlibat = document.getElementById('unsuryangTerlibat').value;
            formData.unsurLainnya = document.getElementById('unsurLainnya').value;

            // Proses File (Async)
            const disposisiFile = document.getElementById('fileDisposisi').files[0];
            if (disposisiFile) {
                formData.fileDisposisi = await readFileAsBase64(disposisiFile);
            } else {
                formData.fileDisposisi = null;
            }

            const dokumentasiFiles = document.getElementById('filesDokumentasi').files;
            formData.filesDokumentasi = []; 
            
            if (dokumentasiFiles.length > 0) {
                const filePromises = Array.from(dokumentasiFiles).map(readFileAsBase64);
                formData.filesDokumentasi = await Promise.all(filePromises);
            }

            return formData;
        }

        function readFileAsBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => {
                    const base64Data = reader.result.split(',')[1];
                    resolve({
                        fileName: file.name,
                        fileType: file.type,
                        fileData: base64Data 
                    });
                };
                reader.onerror = (error) => reject(error);
                reader.readAsDataURL(file);
            });
        }

        // Fungsi ini tidak terpakai tapi biarkan saja
        function getCheckboxValues(name) {
            const checkboxes = document.querySelectorAll(`input[name="${name}"]:checked`);
            const values = Array.from(checkboxes).map(cb => cb.value);
            return values.join(', '); 
        }
        
        function showStatus(message, type) {
            statusMessage.textContent = message;
            statusMessage.className = type;
            statusMessage.style.display = 'block';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

    </script>
</body>

</html>
