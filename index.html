<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Peta Sebaran Terdampak Bencana</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        html, body {
            height: 100%; width: 100%; margin: 0; padding: 0;
            font-family: Arial, sans-serif; overflow: hidden;
        }
        #map { height: 100%; width: 100%; }
        #sidebar {
            position: absolute; left: -350px; top: 10px; bottom: 10px;
            width: 320px; background: white; padding: 15px;
            box-shadow: 0 1px 5px rgba(0,0,0,0.65); border-radius: 5px;
            transition: left 0.5s ease; z-index: 1000; overflow-y: auto;
        }
        #sidebar.visible { left: 10px; }
        #sidebar h3, #sidebar h4 { margin-top: 0; border-bottom: 1px solid #eee; padding-bottom: 10px; }
        #sidebar h4 { margin-top: 15px; font-size: 1em; color: #555; }
        #sidebar p { margin: 5px 0; line-height: 1.6; }
        #sidebar .close-btn {
            position: absolute; top: 10px; right: 15px;
            font-size: 24px; font-weight: bold; cursor: pointer; color: #aaa;
        }
        #sidebar .close-btn:hover { color: #333; }
    </style>
</head>
<body>

<div id="map"></div>
<div id="sidebar">
    <span class="close-btn" onclick="closeSidebar()">&times;</span>
    <div id="sidebar-content"></div>
</div>

<script>
    const DATA_URL = 'https://script.google.com/macros/s/AKfycby1d20U2KKj_Vdno5E1pqhQ3P0KqSHF3El1N75qEbWGuupgzQvtTdMVNp6_uIqFpIMU/exec';
    const mapCenter = [-8.17, 113.70]; // Jember
    const initialZoom = 12;

    const osm = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
    });
    const satellite = L.tileLayer('https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri'
    });
    
    const map = L.map('map', { center: mapCenter, zoom: initialZoom, layers: [osm] });
    const baseMaps = { "Peta Jalan": osm, "Citra Satelit": satellite };
    L.control.layers(baseMaps).addTo(map);

    const iconRusakBerat = new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png', iconSize: [25, 41], iconAnchor: [12, 41] });
    const iconRusakSedang = new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-gold.png', iconSize: [25, 41], iconAnchor: [12, 41] });
    const iconRusakRingan = new L.Icon({ iconUrl: 'https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-green.png', iconSize: [25, 41], iconAnchor: [12, 41] });

    fetch(DATA_URL)
        .then(response => response.json())
        .then(data => {
            data.forEach(item => {
                let chosenIcon = iconRusakRingan;
                if (item.kerusakan === 'Rusak Sedang') chosenIcon = iconRusakSedang;
                else if (item.kerusakan === 'Rusak Berat') chosenIcon = iconRusakBerat;

                const marker = L.marker([item.lat, item.lng], {icon: chosenIcon}).addTo(map);
                marker.on('click', () => openSidebarWithData(item));
            });
        })
        .catch(error => console.error('Gagal mengambil data:', error));

    function openSidebarWithData(data) {
        const sidebar = document.getElementById('sidebar');
        const content = document.getElementById('sidebar-content');
        
        // --- PERUBAHAN UTAMA DI SINI ---
        content.innerHTML = `
            <h3>${data.nama || 'Tidak ada data'}</h3>
            
            <h4>Detail Lokasi</h4>
            <p><strong>Jalan/Dusun:</strong><br>${data.dusun || 'Tidak ada data'}</p>
            <p><strong>Kelurahan/Desa:</strong><br>${data.kelurahan || 'Tidak ada data'}</p>
            <p><strong>Kecamatan:</strong><br>${data.kecamatan || 'Tidak ada data'}</p>
            
            <h4>Detail Bencana & Asesmen</h4>
            <p><strong>Jenis Bencana:</strong><br>${data.bencana || 'Tidak ada data'}</p>
            <p><strong>Waktu Asesmen:</strong><br>${data.hari || ''}, ${data.tanggalWaktu || ''}</p>
            <p><strong>Pengkajian:</strong><br>${data.pengkajian || 'Tidak ada data'}</p>
            
            <h4>Detail Kerusakan & Kerugian</h4>
            <p><strong>Tingkat Kerusakan:</strong><br>${data.kerusakan || 'Tidak ada data'}</p>
            <p><strong>Bagian Rusak:</strong><br>${data.bagianRusak || 'Tidak ada data'}</p>
            <p><strong>Taksiran Kerusakan:</strong><br>${data.nilaiKerusakan || 'Tidak ada data'}</p>
            <p><strong>Taksiran Kerugian:</strong><br>${data.nilaiKerugian || 'Tidak ada data'}</p>
        `;
        
        sidebar.classList.add('visible');
    }

    function closeSidebar() {
        document.getElementById('sidebar').classList.remove('visible');
    }
</script>

</body>
</html>